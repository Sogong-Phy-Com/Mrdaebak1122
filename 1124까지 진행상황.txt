================================================================================
                    미스터 대박 디너 서비스 - 기능 명세서
                        2024년 11월 24일 기준 진행 상황
================================================================================

1. 고객 (Customer)
================================================================================

예시 계정:
  - 이메일: 게스트@게스트.com
  - 비밀번호: 게스트

기능:

1.1 주문하기 (구현됨)
  - 도착 3시간 전까지만 주문 가능 (구현됨)
  - 3시간 미만 잔여시간 시에는 주문 불가 (구현됨)
  - 날짜 시간은 30분 단위로 선택 가능 (구현됨)
  - 내 주소로 배달(고정) / 다른 주소로 배달(변경) 가능 (구현됨)
  - 디너 타입 선택: 발렌타인 디너, 프렌치 디너, 잉글리시 디너, 샴페인 축제 디너 (구현됨)
  - 서빙 스타일 선택: 심플, 그랜드, 디럭스 (구현됨)
  - 메뉴 항목 추가/삭제/수량 변경 가능 (구현됨)

1.2 주문 내역 (구현됨)
  - 배달현황보기 - 배달 현황 및 주문 상태 확인 가능 (구현됨)
  - 주문 목록 조회 (최신순) (구현됨)
  - 주문 상세 정보 확인 (구현됨)

1.3 주문 취소 (구현됨)
  - 배달일로부터 7일 전 이하는 수수료 부과 (구현됨)
    * 7일 이상 남은 경우: 수수료 없음
    * 7일 미만 남은 경우: 30,000원 수수료
  - 주문 취소 기능 (구현됨)
  - 취소 수수료 계산 로직 (구현됨)
  - 환불 금액 표시 (구현됨)

1.4 주문 수정 (구현됨)
  - 기존 주문 디폴트 값으로 주문 수정 가능 (구현됨)
  - 음식 항목 추가/삭제/수량 변경 가능 (구현됨)
  - 배달 시간 및 주소 변경 가능 (구현됨)

1.5 내 정보 관리 (구현됨)
  - 내 정보 확인 (구현됨)
  - 내 정보 변경 (구현됨)
  - 비밀번호 변경 (구현됨)

================================================================================
2. 직원 (Employee)
================================================================================

예시 계정:
  - 이메일: emp1@emp.com ~ emp10@emp.com (직원이 10명)
  - 비밀번호: emp123

기능:

2.1 스케줄 관리 (구현됨)
  
  2.1.1 스케줄 캘린더 (구현됨)
    - 출근일, 휴식일 확인 가능 (구현됨)
    - 관리자가 할당한 작업 확인 가능 (구현됨)
    - 조리/배달 작업 할당 확인 (구현됨)
  
  2.1.2 주문 캘린더 (구현됨)
    - 들어온 주문 확인 가능 (구현됨)
    - 자신에게 할당된 작업 확인 가능 (구현됨)
    - 자신에게 주어진 업무에 대한 주문 상태 변경 가능 (구현됨)
      * 조리 할당: 조리시작, 조리완료 가능 (구현됨)
      * 배달 할당: 배달 시작, 배달 완료 가능 (구현됨)
      * 순서: 조리 -> 조리완료 -> 배달 시작 -> 배달 완료 (구현됨)
      * 배달 직원은 조리가 완료되지 않은 작업에 대해 배달로 상태 변경 불가 (구현됨)

2.2 재고관리 (구현됨)
  - 직원은 재고 확인만 가능 (구현됨)
  - 재고 주문 불가 (구현예정 - 권한 제한)
  - 현재 보유량, 주문 재고, 이번주 예약 수량, 예비 수량 확인 가능 (구현됨)

================================================================================
3. 관리자 (Admin)
================================================================================

예시 계정:
  - 이메일: admin@mrdabak.com
  - 비밀번호: admin123

기능:

3.1 재고 관리 (구현 예정)
  - 재고 확인 + 주문 가능 (구현됨)
  - 재고는 해당 주 예약의 110%만큼 유지하도록 계획 중 (구현 예정)
  - 고객 추가 주문시 보충용 (구현 예정)
  - 현재 보유량 (Current Stock) - 창고에 있는 양 (구현 예정)
  - 주문 재고 (Ordered Stock) - 보충으로 주문한 개수 (구현 예정)
  - 수령 이후 보유량 (Received Stock) - 관리자가 버튼으로 수령 유무 결정 (구현 예정)
    * 수령 버튼 누르면 주문했던 재고만큼이 현재 보유량에 추가되고, 주문 재고는 0으로 변경 (구현 예정)
  - 이번주 예약 수량 (Weekly Reserved Quantity) - 이번주에 필요한 재고의 개수 (구현 예정)
  - 예비 수량 (Spare Quantity) - 이번주 필요한 재고의 수를 초과한 양의 현재보유량 (구현 예정)

3.2 스케줄 관리 (구현됨)
  
  3.2.1 스케줄 캘린더 (구현됨)
    - 조리 5명 / 배달 5명 직원 작업 할당 가능 (구현됨)
    - 관리자는 직원 아님 / 작업 할당받지 않음 (구현됨)
    - 직원 작업 할당 저장 및 확인 (구현됨)
  
  3.2.2 주문 캘린더 (구현됨)
    - 들어온 주문 확인 가능 (구현됨)
    - 주문 상태 변경 확인 가능 (구현됨)
    - 관리자는 직원 아니므로 주문 상태 변경 불가능 (구현됨)
    - 오직 직원에게 작업 할당만 가능 (구현됨)

3.3 계정 관리 (구현됨)
  
  3.3.1 회원 관리 (구현됨)
    - 직원 관리자로 승급 가능 (구현됨)
    - 고객 정보 확인 가능 (구현됨)
    - 직원 정보 확인 가능 (구현됨)
    - 사용자 목록 조회 (구현됨)
  
  3.3.2 계정 승인 (구현됨)
    - 직원이 계정 생성 시 관리자의 승인으로 직원용 계정 활성화 가능 (구현됨)
    - 승인 대기 목록 확인 (구현됨)
    - 승인/거부 처리 (구현됨)

================================================================================
4. 로그인/회원가입 (Authentication)
================================================================================

4.1 회원가입 (구현됨)
  - 고객/직원용으로 계정 생성 가능 (구현됨)
  - 고객은 자동 승인 (구현됨)
  - 직원은 관리자 승인 필요 (구현됨)
  - 비밀번호 찾기용 질문 + 대답 작성 가능 (구현됨)
  - 회원가입 후 환영 팝업 표시 (구현됨)

4.2 로그인 (구현됨)
  - 이메일/비밀번호로 로그인 (구현됨)
  - JWT 토큰 기반 인증 (구현됨)
  - 역할별 자동 리다이렉션 (구현됨)
  - 승인 대기 상태 직원은 승인 대기 화면으로 이동 (구현됨)

4.3 비밀번호 찾기 (구현됨)
  - 이메일과 질문+대답이 일치하면 비밀번호 변경 가능 (구현됨)
  - 보안 질문 선택 및 답변 입력 (구현됨)
  - 비밀번호 재설정 (구현됨)

================================================================================
5. 추가 기능 및 기술 사항
================================================================================

5.1 데이터베이스 구조 (구현됨)
  - 계정 관리용 데이터베이스 (mrdabak.db) (구현됨)
  - 주문 관리용 데이터베이스 (orders.db) (구현됨)
  - 스케줄 관리용 데이터베이스 (schedule.db) (구현됨)
  - 재고 및 창고 관리용 데이터베이스 (inventory.db) (구현됨)

5.2 날짜/시간 처리 (구현됨)
  - 고객 주문 날짜와 관리자/직원 캘린더 날짜 통일 (구현됨)
  - 로컬 시간대 사용 (UTC 변환 없이) (구현됨)
  - 날짜 표시 형식: YYYY-MM-DD (구현됨)

5.3 주문 상태 관리 (구현됨)
  - 주문 상태: pending, cooking, ready, out_for_delivery, delivered, cancelled (구현됨)
  - 상태 변경 순서 검증 (구현됨)
  - 역할별 상태 변경 권한 관리 (구현됨)

5.4 중복 주문 방지 (구현됨)
  - 프론트엔드 중복 제출 방지 (구현됨)
  - 백엔드 중복 요청 차단 (구현됨)
  - 데이터베이스 레벨 중복 검사 (구현됨)

5.5 UI/UX 개선사항 (구현됨)
  - 로딩 상태 표시 (구현됨)
  - 에러 메시지 표시 (구현됨)
  - 즉시 UI 업데이트 (구현됨)
  - 팝업 알림 (구현됨)

================================================================================
6. 구현 예정 / 개선 필요 사항
================================================================================

6.1 주문 취소 수수료 계산 기준 조정 (구현 예정)
  - 현재: 배달일로부터 7일 전 이하 수수료 부과 (30,000원)
  - 요구사항: 배달일로부터 3일 전 이하 수수료 부과로 변경 필요
  - 수수료 계산 로직은 구현되어 있으나 기준일 변경 필요

6.2 재고 자동 보충 계획 (구현 예정)
  - 해당 주 예약의 110%만큼 재고 유지 로직
  - 고객 추가 주문시 자동 보충 로직

6.3 직원 관리자 승급 기능 (구현됨)
  - 관리자가 직원을 관리자로 승급하는 기능
  - 현재: 사용자 정보 확인 가능, 승급 기능 구현

6.4 음성 주문 기능 (구현 예정)
  - Web Speech API를 활용한 음성 인식 주문
  - 현재: 코드에 언급만 있음, 실제 구현 미완료

6.5 단골 고객 할인 (구현 예정)
  - 재주문 시 10% 자동 할인
  - 현재: 코드에 언급만 있음, 실제 구현 미완료

================================================================================
7. 알려진 이슈 및 제한사항
================================================================================

7.1 주문 중복 생성 방지
  - 다중 레이어 중복 방지 로직 구현 완료
  - 간헐적으로 발생할 수 있는 중복 주문에 대한 모니터링 필요

7.2 날짜 표시 통일
  - 고객/관리자/직원 캘린더 날짜 표시 통일 완료
  - 로컬 시간대 사용으로 UTC 변환 문제 해결

7.3 관리자 작업 할당
  - 로딩 상태 표시 및 저장 확인 로직 구현 완료
  - 할당 저장 후 즉시 반영 확인

================================================================================
8. 데이터베이스 스키마
================================================================================

계정 관리용 (mrdabak.db):
  - users: 사용자 정보 (고객, 직원, 관리자)
  - dinner_types: 디너 타입
  - menu_items: 메뉴 항목
  - dinner_menu_items: 디너-메뉴 항목 관계

주문 관리용 (orders.db):
  - orders: 주문 정보
  - order_items: 주문 항목

스케줄 관리용 (schedule.db):
  - delivery_schedules: 배달 스케줄
  - employee_work_assignments: 직원 작업 할당

재고 관리용 (inventory.db):
  - menu_inventory: 메뉴 재고 정보
  - inventory_reservations: 재고 예약 정보

================================================================================
문서 작성일: 2024년 11월 24일
최종 업데이트: 2024년 11월 24일
================================================================================

